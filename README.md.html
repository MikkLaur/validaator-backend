<!DOCTYPE html><html><head><meta charset="utf-8"><title>README.md</title><script type="text/javascript">
//<![CDATA[
window.__cfRocketOptions = {byc:0,p:0,petok:"e1fced49bec31b7a12de065ee4bb8b92d4367638-1516890864-1800"};
//]]>
</script>
<script type="text/javascript" src="https://ajax.cloudflare.com/cdn-cgi/scripts/b7ef205d/cloudflare-static/rocket.min.js"></script>
<style></style></head><body id="preview">
<h1><a id="Validaator_Simulaator_0"></a>Validaator Simulaator</h1>
<p>Validaator Simulaator tries to simulate the e-ticketing system Ridango AS has applied to public transportation systems in Estonia and in some places of Sweden and Ukraine. This simulation has been done in a very crude and basic fashion.</p>
<h2><a id="Backend_4"></a>Backend</h2>
<p>Technologies used:</p>
<ul>
<li>REST API</li>
<li>Relational database</li>
</ul>
<p>A webserver is running powered by <a href="http://sparkjava.com/">Spark Framework</a>, which listens to certain Restful routes to query the <a href="https://www.postgresql.org/">PostgrSQL</a> database. Available API routes are discussed later.</p>
<h4><a id="Installation_12"></a>Installation</h4>
<p>Validaator Simulaator requires <a href="https://www.postgresql.org/download/">PostgreSQL</a> to be installed and the service must be running.<br>
The application will need a database on URL <code>localhost:5432/validaatordb</code>, a user named <code>testuser</code> with a password <code>test</code>.<br>
Running these commands from Linux terminal creates a database and a user (requires sudo):</p>
<pre><code>$ sudo -u postgres psql -c &quot;CREATE DATABASE validaatordb;&quot;
$ sudo -u postgres psql -c &quot;CREATE USER testuser WITH PASSWORD 'test';GRANT ALL PRIVILEGES ON DATABASE validaatordb TO testuser;&quot;
</code></pre>
<p>Table creation is handled by a gradle task: <code>$ gradle firstTimeSetup</code>. This task creates the tables and populates them with dummy data.</p>
<h6><a id="Configuring_database_credentials_22"></a>Configuring database credentials</h6>
<p>If you wish to change the credentials used by the project, read the following.</p>
<ul>
<li>Configuring from a config file has not been implemented and must be done manually</li>
</ul>
<p>Credentials must be changed in two places.<br>
In the constructor of DatabaseWrapper class and in gradle.build.</p>
<pre><code>/src/main/java/server.database.DatabaseWrapper.java
/gradle.build
</code></pre>
<h4><a id="Running_the_project_32"></a>Running the project</h4>
<p>The project is using gradle to pull in third-party libraries. It is also using Gradle to set up the database with needed tables and populate it with dummy data.<br>
First the database tables must be created with <code>$ gradle firstTimeSetup</code>.<br>
Then the project is ready to be executed with <code>$ gradle run</code>.<br>
Once the application is running, the RESTful routes are open for HTTP requests on <code>localhost:5432/</code>.</p>
<h4><a id="Routes_38"></a>Routes</h4>
<p><code>GET /api/users</code></p>
<pre><code>Returns all users in a JSONArray format.
    [ &quot;$id&quot;: {
        &quot;name&quot;:          &quot;$name&quot;.
        &quot;personal_id&quot;:   &quot;$personal_id&quot;,
        &quot;date_of_birth&quot;: &quot;$dateOfBirth&quot;,
        &quot;date_added&quot;:    &quot;$dateAdded&quot;
         },
        ...
    ]
</code></pre>
<p><code>POST /api/users</code></p>
<pre><code>Adds a user on the database.
    Accepts a json in format:
        {
            &quot;name&quot;:          &quot;$name&quot;,
            &quot;personal_id&quot;:   &quot;$personalId&quot;,
            &quot;date_of_birth&quot;: &quot;$dateOfBirth&quot;
        }

    Upon success, returns the $id (database id) of the new user.
    Upon failure, returns -1.
        Fails when:
            - A user with a same personal_id already exists on the DB
            - TODO: validate personal_id with a regex pattern
</code></pre>
<p><code>GET /api/stops</code></p>
<pre><code>Returns all stops in a JSONArray format.
    [ &quot;$id&quot;: {
        &quot;name&quot;:          &quot;$name&quot;.
        &quot;date_added&quot;:    &quot;$dateAdded&quot;
        },
    ...
    ]
</code></pre>
<p><code>POST /api/stops</code></p>
<pre><code>Adds a stop on the database.
    Accepts a json in format:
    {
        &quot;name&quot;:          &quot;$name&quot;,
        &quot;personal_id&quot;:   &quot;$personalId&quot;,
        &quot;date_of_birth&quot;: &quot;$dateOfBirth&quot;,
    }

    Upon success, returns the $id of the new stop.
    Upon failure, returns -1.
      Fails when:
        - No constraints! There may be multiple stops with the same name.
</code></pre>
<p><code>POST /api/tickets</code></p>
<pre><code>Registers a ticket validation on the database
    Accepts a json in format:
        {
            &quot;user_id&quot;:  &quot;$user_id&quot;,
            &quot;stop_id&quot;:  &quot;$stop_id&quot;,
        }

    Upon success, returns the $ticketNr of the new ticket.
    Upon failure, returns -1
        Fails when:
            -
</code></pre>
<p><code>GET /api/users/:id/tickethistory</code></p>
<pre><code>Returns user's ticket validation history in detail, in json array.
    [ &quot;$ticketNr&quot;: {
        &quot;stop_name&quot;:     &quot;$stopName&quot;.
        &quot;date_added&quot;:    &quot;$dateAdded&quot;
        },
        ...
    ]

    Upon failure, returns &quot;&quot;
    Fails when:
        - user with :id does not exist
</code></pre>
<h5><a id="Database_managment_with_gradle_116"></a>Database managment with gradle</h5>
<p><code>$ gradle firstTimeSetup</code><br>
Creates the users, stops and transaction tables . Then inserts dummy data.<br>
<code>$ gradle reset</code><br>
Drops all tables and runs firstTimeSetup</p>
<p><code>$ gradle createTables</code><br>
Creates the users, stops and transaction tables.<br>
<code>$ gradle populateTables</code><br>
Inserts dummy data into users and stops tables.<br>
<code>$ gradle clearTables</code><br>
Deletes all insertions from tables. Does not clear sequence tables.<br>
<code>$ gradle dropTables</code><br>
Drops all tables and sequences in the database.</p>
<h4><a id="What_could_be_improved_132"></a>What could be improved</h4>
<ul>
<li>API Authentication is a must in production</li>
<li>Tests</li>
<li>More routes</li>
<li>Higher abstraction</li>
<li>Handling of big queries</li>
<li>More automation with Gradle</li>
</ul>
<h5><a id="Dependencies_141"></a>Dependencies</h5>
<p><a href="https://mvnrepository.com/artifact/org.json/json/20171018">org.json:json:20171018</a><br>
<a href="https://mvnrepository.com/artifact/com.sparkjava/spark-core/2.3">com.sparkjava:spark-core:2.7.1</a><br>
<a href="https://mvnrepository.com/artifact/org.slf4j/slf4j-simple">org.slf4j:slf4j-simple:1.7.25</a><br>
<a href="https://mvnrepository.com/artifact/org.postgresql/postgresql/42.2.0">org.postgresql:postgresql:42.2.0</a><br>
<a href="https://mvnrepository.com/artifact/junit/junit/4.12">junit:junit:4.12</a></p>
<hr>
<hr>
<hr>

</body></html>